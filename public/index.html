<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>TensorFlow.js ejemplo</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0"></script>
</head>
  <body style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; row-gap: 10px; margin: 0;">
  <h1>TensorFlow.js ejemplo</h1>
  <p>Formula: y = 2x + 6</p>

  <button onclick="entrenarModelo()">Entrenar Modelo</button>
  <input type="number" id="inputX" value="4" />
  <button onclick="predecir()">Predecir</button>

  <p id="resultado"></p>

  <script>
    // variable del modelo
    let modelo;
  
    // funcion que entrena el modelo usando tensorflow
    async function entrenarModelo() {
      // mostramos que se esta entrenando
      document.getElementById('resultado').innerText = "Entrenando modelo";
  
      // creamos un modelo secuencial que es el tipo mas comun
      modelo = tf.sequential();
  
      // le agregamos una sola capa con una neurona porque solo vamos a predecir un valor
      modelo.add(tf.layers.dense({ units: 1, inputShape: [1] }));
  
      // el modelo se compila y le deicmos que metodo usar para minimizar errores
      // y que optimizador usar para ajustar los pesos durante el entrenamiento
      modelo.compile({ loss: 'meanSquaredError', optimizer: 'sgd' });
  
      // datos de prueba q va de x del -6 al 2
      const xTrain = tf.tensor1d([-6, -5, -4, -3, -2, -1, 0, 1, 2]);
  
      // datos de salida segun la funcion esa
      const yTrain = tf.tensor1d([-6, -4, -2, 0, 2, 4, 6, 8, 10]);
  
      // entrenamos el modelo con esos datos durante 350 epocas que es como repetir muchas veces el aprendizaje
      await modelo.fit(xTrain, yTrain, { epochs: 350 });
  
      // avisamos que ya termino y esta listo para usar
      document.getElementById('resultado').innerText = "Modelo entrenado y listo para usar";
    }
  
    // funcion que se ejecuta cuando el usuario quiere predecir un valor
    async function predecir() {
      // si todavia no se entreno mostramos un mensaje y no hacemos nada
      if (!modelo) {
        document.getElementById('resultado').innerText = "Primero entrena el modelo";
        return;
      }
      
      const x = parseFloat(document.getElementById('inputX').value);//lo convertimos en float por las duda
  
      // lo convertimos en un tensor 2d porque el modelo espera ese formato
      const resultado = modelo.predict(tf.tensor2d([x], [1, 1]));
  
      // sacamos el resultado numerico del tensor
      const y = await resultado.data();
  
      document.getElementById('resultado').innerText = `El resultado de predecir para ${x} es: ${y[0]}`;
    }
  </script>
  
</body>
</html>
